<!DOCTYPE html>
<html class="no-js gt-ie8" dir="ltr" lang="en">
<head>
	<meta charset="utf-8" >
			<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" >
			<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
			<script src="http://fast.fonts.net/jsapi/124d48dd-e515-4302-8bfb-1d5c1e3da916.js"></script>
			<link rel="stylesheet" href="http://cdn.ttgtmedia.com/rms/ux/responsive/css/libs/normalize.css">
			<link rel="stylesheet" href="http://cdn.ttgtmedia.com/rms/ux/responsive/css/libs/icomoon.css">
			<link rel="stylesheet" href="http://cdn.ttgtmedia.com/rms/ux/responsive/css/libs/jquery-ui-1.10.3.custom.min.css">
			<link rel="stylesheet" href="http://cdn.ttgtmedia.com/rms/ux/responsive/css/v8-legacy.css">
			<link rel="stylesheet" href="http://cdn.ttgtmedia.com/rms/ux/responsive/css/main.css?v=6.53">

</head>

<body id="home">
	<div id="site-container" class="site-container">
	</div>
	<div class="header-gradient">
		<img src="http://cdn.ttgtmedia.com/rms/ux/responsive/img/temp/home_gradient_desktop.png" />
	</div>
<div id="main-content" class="main-content">
	<article id="content-columns" class="content-columns">
	<div>
	<header class="homepage-header">
		<h1 class="homepage-title searchitchannel"><span class="logo-search">Example</span><span class="logo-1">RSS</span><span class="logo-2">Feed</span></h1>
	</header>
</div>
<div id="content-left" class="content-left">
		<div class="locking-full-bar">
			<div class="locking-left-bar">
			</div>
			<aside class="resources-bar desktop-resources-bar" id="resources-bar">
			</aside>
		</div>
</div>
<div id="content-center" class="content-center">
	<div><div>
		<section class="homepage-section trending-topics-home" id="trending-topics">
				<h2 id="topic-title">Trending Topics</h2>
				<ul class="trending-topics-items tt-list-1" id="article-list">
				<!--Inject Template Here-->
				</ul>
		</section>
	</div>
</div>
<div>
	<footer id="page-footer">
	</footer>
</div>
</div>

<script src="http://cdn.ttgtmedia.com/rms/ux/responsive/js/responsive-ui.min.js?v=6.53"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.min.js"></script>
</script>
<script>

var feedarray = [
	"http://searchstorage.techtarget.com/rss/News-and-trends-in-the-storage-industry.xml",
	"http://searchnetworking.techtarget.com/rss/News-on-networking-mobility-and-voice.xml",
	"http://searchsecurity.techtarget.com/rss/Security-Wire-Daily-News.xml",
];

var displayArticles = []; //Array of articles to be displayed in center list;

//Retrieve the html template to be used for each Article object
var template;
$.ajax({
    url: '/articletemplate',
    cache: true,
    success: function(data) {
      	var source = data;
        template = Handlebars.compile(source); //Using Handlebars as the templating engine
        }               
});  

// For each RSS feed, retreive RSS data from server in json format.
$(feedarray).each(function(index, element){
	var body = {url: element};
	$.ajax({
		url: '/rss',
		type: 'POST',
		data: body,
	 	success: function(data) {
	 		//console.log(data);
	 		$('#topic-title').html(data[0].feed.name); //Change titlebar to name of RSS feed
	    	$(data).each(function (index2, value) {
	    		var meta = {
					title: value.title,
					description: value.content,
					link: value.link,
					date: value.published
				}
				displayArticles.push(meta);
	    	});
	    	if(index = feedarray.length-1){
				displayArticles.sort(function(a,b){
			  		return new Date(b.date) - new Date(a.date);
				});
				for(var i=0; i<displayArticles.length; i++){
					var html = template(displayArticles[i]); //Replace each empty field in html template with parsed RSS data
	        		$('#article-list').append(html); //Inject finalized template into article list
				}
			}
		}
	});
});

</script>
</body>
</html>
